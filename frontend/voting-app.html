<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Voting System</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        
        .voting-section {
            margin-bottom: 30px;
        }
        
        .vote-option {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .vote-option:hover {
            border-color: #667eea;
            background: #f0f2ff;
        }
        
        .vote-option.selected {
            border-color: #667eea;
            background: #e6f3ff;
        }
        
        .vote-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin-top: 20px;
            transition: background 0.3s ease;
        }
        
        .vote-button:hover {
            background: #5a6fd8;
        }
        
        .vote-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .status {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .status.open {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.closed {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .admin-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 20px;
            margin-top: 30px;
        }
        
        .admin-button {
            background: #ffc107;
            color: #212529;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        .admin-button:hover {
            background: #e0a800;
        }
        
        .results {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üó≥Ô∏è Simple Voting System</h1>
        
        <div id="status" class="status">
            <strong>Status:</strong> <span id="votingStatus">Loading...</span>
        </div>
        
        <div class="voting-section">
            <h3>Choose your option:</h3>
            
            <div class="vote-option" data-option="1">
                <h4>Option 1: üöÄ Innovation</h4>
                <p>Focus on cutting-edge technology and innovation</p>
            </div>
            
            <div class="vote-option" data-option="2">
                <h4>Option 2: üå± Sustainability</h4>
                <p>Prioritize environmental sustainability and green tech</p>
            </div>
            
            <div class="vote-option" data-option="3">
                <h4>Option 3: ü§ù Community</h4>
                <p>Build strong community and social impact</p>
            </div>
            
            <button id="voteButton" class="vote-button" disabled>
                Cast Your Vote
            </button>
        </div>
        
        <div class="admin-section">
            <h3>Admin Controls</h3>
            <button id="toggleVoting" class="admin-button">Toggle Voting</button>
            <button id="getResults" class="admin-button">Get Results</button>
            <button id="refreshStatus" class="admin-button">Refresh Status</button>
        </div>
        
        <div id="results" class="results" style="display: none;">
            <h3>Voting Results</h3>
            <p><strong>Total Votes:</strong> <span id="totalVotes">-</span></p>
            <p><strong>Option 1:</strong> <span id="option1Votes">-</span></p>
            <p><strong>Option 2:</strong> <span id="option2Votes">-</span></p>
            <p><strong>Option 3:</strong> <span id="option3Votes">-</span></p>
        </div>
    </div>

    <script>
        let selectedOption = null;
        let contract = null;
        let account = null;
        let contractAddress = null;
        let contractABI = null;
        
        // Contract ABI (simplified)
        const contractABI = [
            {
                "inputs": [{"internalType": "uint8", "name": "vote", "type": "uint8"}],
                "name": "castVote",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "getOption1Votes",
                "outputs": [{"internalType": "uint32", "name": "", "type": "uint32"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "getOption2Votes",
                "outputs": [{"internalType": "uint32", "name": "", "type": "uint32"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "getOption3Votes",
                "outputs": [{"internalType": "uint32", "name": "", "type": "uint32"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "getTotalVotes",
                "outputs": [{"internalType": "uint32", "name": "", "type": "uint32"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "isVotingOpen",
                "outputs": [{"internalType": "bool", "name": "", "type": "bool"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "closeVoting",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "openVoting",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            }
        ];
        
        // Initialize the app
        async function init() {
            try {
                // Check if MetaMask is installed
                if (typeof window.ethereum !== 'undefined') {
                    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    account = accounts[0];
                    console.log('Connected account:', account);
                    
                    // Load contract info
                    await loadContractInfo();
                    
                    // Initialize contract
                    if (contractAddress) {
                        const provider = new ethers.BrowserProvider(window.ethereum);
                        contract = new ethers.Contract(contractAddress, contractABI, provider);
                        console.log('Contract initialized:', contractAddress);
                    }
                    
                    updateVotingStatus();
                } else {
                    alert('Please install MetaMask to use this voting system');
                }
            } catch (error) {
                console.error('Error initializing:', error);
            }
        }
        
        // Load contract information
        async function loadContractInfo() {
            try {
                const response = await fetch('./contract-info.json');
                const contractInfo = await response.json();
                contractAddress = contractInfo.address;
                console.log('Contract address loaded:', contractAddress);
            } catch (error) {
                console.error('Error loading contract info:', error);
                alert('Contract not deployed. Please run: npm run deploy-simple');
            }
        }
        
        // Update voting status
        async function updateVotingStatus() {
            try {
                if (!contract) return;
                
                const isOpen = await contract.isVotingOpen();
                const statusElement = document.getElementById('votingStatus');
                const statusDiv = document.getElementById('status');
                
                if (isOpen) {
                    statusElement.textContent = 'Voting is OPEN';
                    statusDiv.className = 'status open';
                    document.getElementById('voteButton').disabled = false;
                } else {
                    statusElement.textContent = 'Voting is CLOSED';
                    statusDiv.className = 'status closed';
                    document.getElementById('voteButton').disabled = true;
                }
            } catch (error) {
                console.error('Error updating status:', error);
            }
        }
        
        // Handle vote option selection
        document.querySelectorAll('.vote-option').forEach(option => {
            option.addEventListener('click', function() {
                // Remove previous selection
                document.querySelectorAll('.vote-option').forEach(opt => opt.classList.remove('selected'));
                
                // Add selection to clicked option
                this.classList.add('selected');
                selectedOption = parseInt(this.dataset.option);
                
                // Enable vote button
                document.getElementById('voteButton').disabled = false;
            });
        });
        
        // Handle vote casting
        document.getElementById('voteButton').addEventListener('click', async function() {
            if (!selectedOption) {
                alert('Please select an option first');
                return;
            }
            
            if (!contract) {
                alert('Contract not connected');
                return;
            }
            
            try {
                this.disabled = true;
                this.textContent = 'Casting vote...';
                
                // Cast vote
                const tx = await contract.castVote(selectedOption);
                await tx.wait();
                
                alert(`Vote cast for Option ${selectedOption}!`);
                
                // Reset selection
                document.querySelectorAll('.vote-option').forEach(opt => opt.classList.remove('selected'));
                selectedOption = null;
                this.textContent = 'Cast Your Vote';
                this.disabled = true;
                
                // Refresh results
                await getResults();
                
            } catch (error) {
                console.error('Error casting vote:', error);
                alert('Error casting vote. Please try again.');
                this.disabled = false;
                this.textContent = 'Cast Your Vote';
            }
        });
        
        // Admin functions
        document.getElementById('toggleVoting').addEventListener('click', async function() {
            if (!contract) {
                alert('Contract not connected');
                return;
            }
            
            try {
                const isOpen = await contract.isVotingOpen();
                if (isOpen) {
                    await contract.closeVoting();
                    alert('Voting closed!');
                } else {
                    await contract.openVoting();
                    alert('Voting opened!');
                }
                updateVotingStatus();
            } catch (error) {
                console.error('Error toggling voting:', error);
                alert('Error toggling voting. Make sure you are the owner.');
            }
        });
        
        document.getElementById('getResults').addEventListener('click', async function() {
            await getResults();
        });
        
        document.getElementById('refreshStatus').addEventListener('click', async function() {
            await updateVotingStatus();
        });
        
        // Get and display results
        async function getResults() {
            if (!contract) {
                alert('Contract not connected');
                return;
            }
            
            try {
                document.getElementById('results').style.display = 'block';
                document.getElementById('totalVotes').textContent = 'Loading...';
                
                const totalVotes = await contract.getTotalVotes();
                const option1Votes = await contract.getOption1Votes();
                const option2Votes = await contract.getOption2Votes();
                const option3Votes = await contract.getOption3Votes();
                
                document.getElementById('totalVotes').textContent = totalVotes.toString();
                document.getElementById('option1Votes').textContent = option1Votes.toString();
                document.getElementById('option2Votes').textContent = option2Votes.toString();
                document.getElementById('option3Votes').textContent = option3Votes.toString();
                
            } catch (error) {
                console.error('Error getting results:', error);
                alert('Error getting results. Please try again.');
            }
        }
        
        // Initialize when page loads
        window.addEventListener('load', init);
    </script>
    
    <!-- Include ethers.js -->
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
</body>
</html>
