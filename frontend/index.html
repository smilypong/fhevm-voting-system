<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FHEVM Voting System</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        
        .voting-section {
            margin-bottom: 30px;
        }
        
        .vote-option {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .vote-option:hover {
            border-color: #667eea;
            background: #f0f2ff;
        }
        
        .vote-option.selected {
            border-color: #667eea;
            background: #e6f3ff;
        }
        
        .vote-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin-top: 20px;
            transition: background 0.3s ease;
        }
        
        .vote-button:hover {
            background: #5a6fd8;
        }
        
        .vote-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .status {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .status.open {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.closed {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .admin-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 20px;
            margin-top: 30px;
        }
        
        .admin-button {
            background: #ffc107;
            color: #212529;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        .admin-button:hover {
            background: #e0a800;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üó≥Ô∏è FHEVM Privacy-Preserving Voting</h1>
        
        <div id="status" class="status">
            <strong>Status:</strong> <span id="votingStatus">Loading...</span>
        </div>
        
        <div class="voting-section">
            <h3>Choose your option:</h3>
            
            <div class="vote-option" data-option="1">
                <h4>Option 1: üöÄ Innovation</h4>
                <p>Focus on cutting-edge technology and innovation</p>
            </div>
            
            <div class="vote-option" data-option="2">
                <h4>Option 2: üå± Sustainability</h4>
                <p>Prioritize environmental sustainability and green tech</p>
            </div>
            
            <div class="vote-option" data-option="3">
                <h4>Option 3: ü§ù Community</h4>
                <p>Build strong community and social impact</p>
            </div>
            
            <button id="voteButton" class="vote-button" disabled>
                Cast Your Vote
            </button>
        </div>
        
        <div class="admin-section">
            <h3>Admin Controls</h3>
            <button id="toggleVoting" class="admin-button">Toggle Voting</button>
            <button id="getResults" class="admin-button">Get Results</button>
        </div>
        
        <div id="results" style="margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 8px; display: none;">
            <h3>Voting Results (Encrypted)</h3>
            <p><strong>Total Votes:</strong> <span id="totalVotes">-</span></p>
            <p><strong>Option 1:</strong> <span id="option1Votes">-</span></p>
            <p><strong>Option 2:</strong> <span id="option2Votes">-</span></p>
            <p><strong>Option 3:</strong> <span id="option3Votes">-</span></p>
            <p><em>Note: Results are encrypted and can only be decrypted by the contract owner</em></p>
        </div>
    </div>

    <script>
        let selectedOption = null;
        let contract = null;
        let account = null;
        
        // Initialize the app
        async function init() {
            try {
                // Check if MetaMask is installed
                if (typeof window.ethereum !== 'undefined') {
                    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    account = accounts[0];
                    console.log('Connected account:', account);
                    
                    // Initialize contract (you'll need to replace with actual contract address)
                    // contract = new ethers.Contract(contractAddress, contractABI, provider);
                    
                    updateVotingStatus();
                } else {
                    alert('Please install MetaMask to use this voting system');
                }
            } catch (error) {
                console.error('Error initializing:', error);
            }
        }
        
        // Update voting status
        async function updateVotingStatus() {
            try {
                // Simulate checking voting status
                const isOpen = true; // Replace with actual contract call
                const statusElement = document.getElementById('votingStatus');
                const statusDiv = document.getElementById('status');
                
                if (isOpen) {
                    statusElement.textContent = 'Voting is OPEN';
                    statusDiv.className = 'status open';
                    document.getElementById('voteButton').disabled = false;
                } else {
                    statusElement.textContent = 'Voting is CLOSED';
                    statusDiv.className = 'status closed';
                    document.getElementById('voteButton').disabled = true;
                }
            } catch (error) {
                console.error('Error updating status:', error);
            }
        }
        
        // Handle vote option selection
        document.querySelectorAll('.vote-option').forEach(option => {
            option.addEventListener('click', function() {
                // Remove previous selection
                document.querySelectorAll('.vote-option').forEach(opt => opt.classList.remove('selected'));
                
                // Add selection to clicked option
                this.classList.add('selected');
                selectedOption = parseInt(this.dataset.option);
                
                // Enable vote button
                document.getElementById('voteButton').disabled = false;
            });
        });
        
        // Handle vote casting
        document.getElementById('voteButton').addEventListener('click', async function() {
            if (!selectedOption) {
                alert('Please select an option first');
                return;
            }
            
            try {
                // In a real implementation, you would:
                // 1. Encrypt the vote using FHEVM
                // 2. Send the encrypted vote to the contract
                // 3. Handle the transaction
                
                alert(`Vote cast for Option ${selectedOption}! (This is a demo - actual FHEVM integration needed)`);
                
                // Reset selection
                document.querySelectorAll('.vote-option').forEach(opt => opt.classList.remove('selected'));
                selectedOption = null;
                this.disabled = true;
                
            } catch (error) {
                console.error('Error casting vote:', error);
                alert('Error casting vote. Please try again.');
            }
        });
        
        // Admin functions
        document.getElementById('toggleVoting').addEventListener('click', async function() {
            try {
                // In real implementation, call contract function
                alert('Voting status toggled! (Demo mode)');
                updateVotingStatus();
            } catch (error) {
                console.error('Error toggling voting:', error);
            }
        });
        
        document.getElementById('getResults').addEventListener('click', async function() {
            try {
                // In real implementation, get encrypted results from contract
                document.getElementById('results').style.display = 'block';
                document.getElementById('totalVotes').textContent = 'Encrypted Data';
                document.getElementById('option1Votes').textContent = 'Encrypted Data';
                document.getElementById('option2Votes').textContent = 'Encrypted Data';
                document.getElementById('option3Votes').textContent = 'Encrypted Data';
            } catch (error) {
                console.error('Error getting results:', error);
            }
        });
        
        // Initialize when page loads
        window.addEventListener('load', init);
    </script>
</body>
</html>
